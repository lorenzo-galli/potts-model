<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>daje</title>
    <script src="wrapping.js"></script>
    <script src="potts.js"></script>
</head>
<body>
    <p>Ci si prova</p>

    <label for="numColors">Numero di Colori (Q):</label>
    <input
      type="range"
      id="numColors"
      min="2" max="16" step="1"
      value="5"
      oninput="document.getElementById('numColors-value').textContent = this.value"
    />
    <span id="numColors-value">5</span>

    <br>

    <label for="boardLenght">Lunghezza del Board (L):</label>
    <input
      type="range"
      id="boardLenght"
      min="2" max="256" step="1"
      value="40"
      oninput="document.getElementById('boardLenght-value').textContent = this.value"
    />
    <span id="boardLenght-value">40</span>

    <br>

    <label for="temperature">Temperatura (T/Tc):</label>
    <input 
    type="range" 
    id="temperature" 
    min="0" max="10" step="0.01"
    value="1"
    oninput="document.getElementById('temperature-value').textContent = this.value">
    <span id="temperature-value">50</span>
    <br>
    <input type="number" id="a">
    <input type="number" id="b">
    <button id="trigger">Trigger</button>
    <div id="result"></div>

    <canvas id="canvas"></canvas>

    <script>
      // 1) your existing WASM init happens here â€¦
      Module.onRuntimeInitialized = () => {
        var Q = 5, L = 40;
        let ptr = Module.ccall('init_board','number',['number','number'],[Q,L]);
        const raw   = Module.HEAPU8.subarray(ptr,ptr+L*L);
        const board = Array.from(raw);
        init_board(L, Q, board);
      };

    
        temperature.addEventListener('input',() => {
          const T = Number(temperature.value)/Math.log(1+Math.sqrt(Q));

          ptr = Module.ccall('update_board','number',['number'],[T]);
          const updated = Module.HEAPU8.subarray(ptr,ptr+L*L);
          gboard = Array.from(updated);
          draw_all(gboard);
        });
        

    const triggerButton = document.getElementById('trigger');
    triggerButton.addEventListener('click', () => {
        const Q = document.getElementById('numColors').value;
        const L = document.getElementById('boardLenght').value;
        let ptr = Module.ccall('init_board','number',['number','number'],[Q,L]);
        const raw   = Module.HEAPU8.subarray(ptr,ptr+L*L);
        const board = Array.from(raw);
        init_board(L, Q, board);

      });
    </script>
  </body>
</html>



<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>daje</title>
    <script src="wrapping.js"></script>
    <script src="potts.js"></script>
</head>
<body>
    <p>Ci si prova</p>

    <label for="numColors">Numero di Colori (Q):</label>
    <input
      type="range"
      id="numColors"
      min="2" max="16" step="1"
      value="5"
      oninput="document.getElementById('numColors-value').textContent = this.value"
    />
    <span id="numColors-value">5</span>

    <br>

    <label for="boardLenght">Lunghezza del Board (L):</label>
    <input
      type="range"
      id="boardLenght"
      min="2" max="256" step="1"
      value="40"
      oninput="document.getElementById('boardLenght-value').textContent = this.value"
    />
    <span id="boardLenght-value">40</span>

    <br>

    <label for="temperature">Temperatura (T/Tc):</label>
    <input 
    type="range" 
    id="temperature" 
    min="0" max="90" step="0.01"
    value="1"
    oninput="document.getElementById('temperature-value').textContent = this.value">
    <span id="temperature-value">50</span>
    <br>
    <input type="number" id="a">
    <input type="number" id="b">
    <button id="trigger">Trigger</button>
    <button id="play">Play</button>
    <button id="stop">Stop</button>
    <div id="result"></div>

    <canvas id="canvas"></canvas>

    <script>
  Module.onRuntimeInitialized = () => {
    // 1) initial parameters
    var Q = 5; 
    var L = 40;

    // 2) draw the very first board
    ptr = Module.ccall('init_board','number',['number','number'],[Q,L]);
    let raw   = Module.HEAPU8.subarray(ptr, ptr + L*L);
    let board = Array.from(raw);
    init_board(L, Q, board);

    // 3) define a reusable update function
    function updateStep() {
      // recompute T from the slider
      const T = Number(document.getElementById('temperature').value) / Math.log(1 + Math.sqrt(Q));
      // call into C and redraw
      ptr = Module.ccall('update_board','number',['number'],[T]);
      let updated = Module.HEAPU8.subarray(ptr, ptr + L*L);
      gboard = Array.from(updated);
      draw_all(gboard);
    }

    // 4) wire the slider to update T immediately
    document.getElementById('temperature')
            .addEventListener('input', updateStep);

    // 5) start the 50 ms timer and save its ID
    let intervalId = setInterval(updateStep, 50);

    // 6) Play/Stop buttons
    document.getElementById('stop').addEventListener('click', () => {
      clearInterval(intervalId);
      intervalId = null;
    });
    document.getElementById('play').addEventListener('click', () => {
      if (!intervalId) {
        intervalId = setInterval(updateStep, 50);
      }
    });
  };

  const triggerButton = document.getElementById('trigger');
  triggerButton.addEventListener('click', () => {
      const Q = document.getElementById('numColors').value;
      const L = document.getElementById('boardLenght').value;
      let ptr = Module.ccall('init_board','number',['number','number'],[Q,L]);
      const raw   = Module.HEAPU8.subarray(ptr,ptr+L*L);
      const board = Array.from(raw);
      init_board(L, Q, board);

    });
    </script>
  </body>
</html>

